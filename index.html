<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ryaan Jewellers ‚Äî Gold & Diamonds ¬∑ Crafted with Love</title>
<meta name="description" content="Ryaan Jewellers ‚Äî Premium 18k Gold & Diamond Jewellery. Live UAE gold rates. Shop luxury collections." />
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"></script>
<script src="https://js.stripe.com/v3/"></script>

<style>
  :root{
    --bg:#090909; --card:#0e0e0f; --text:#f6f6f6; --muted:#bdbdbd; --gold:#D4AF37;
    --glass: rgba(255,255,255,0.03);
  }
  :root[data-theme="light"]{
    --bg:#fff; --card:#f5f5f5; --text:#111; --muted:#666; --gold:#b8860b; --glass: rgba(0,0,0,0.04);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial; background:var(--bg);color:var(--text)}
  img{max-width:100%;display:block}

  /* Header */
  header{position:sticky;top:0;z-index:9999;padding:12px 6%;display:flex;align-items:center;justify-content:space-between;backdrop-filter: blur(6px);background:linear-gradient(180deg, rgba(0,0,0,0.45), transparent);border-bottom:1px solid rgba(212,175,55,0.04)}
  .logo-row{display:flex;align-items:center;gap:12px}
  .logo-row img{height:84px;object-fit:contain}
  .controls{display:flex;gap:10px;align-items:center}
  .btn{background:var(--gold);color:#111;padding:8px 12px;border-radius:10px;border:none;font-weight:700;cursor:pointer}
  .ghost{background:transparent;border:1px solid var(--glass);padding:8px 10px;border-radius:10px;color:var(--text);cursor:pointer}

  /* Splash */
  #splash{position:fixed;inset:0;z-index:100000;background:#000;display:flex;align-items:center;justify-content:center;transition:opacity .6s ease;overflow:hidden}
  .splash-inner{position:relative;width:520px;height:520px;border-radius:50%;display:flex;align-items:center;justify-content:center}
  .splash-inner .bgGlow{position:absolute;inset:-20%;border-radius:50%;filter:blur(50px);background:radial-gradient(circle, rgba(212,175,55,0.12), transparent 40%);animation:spin 8s linear infinite}
  @keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}
  .splash-inner img{width:300px;height:auto;object-fit:contain;filter:drop-shadow(0 30px 60px rgba(0,0,0,0.6))}
  .sparkles{position:absolute;inset:0;pointer-events:none}
  .sparkles span{position:absolute;width:6px;height:6px;border-radius:50%;background:radial-gradient(circle,#fff 0%, rgba(212,175,55,0.95) 30%, transparent 70%);opacity:0;filter:blur(.4px);animation:tw 2.6s infinite}
  @keyframes tw{0%{transform:scale(.6);opacity:0}40%{opacity:1;transform:scale(1.05)}70%{opacity:.6;transform:scale(.9)}100%{opacity:0;transform:scale(.6)}}
  .hide{opacity:0;pointer-events:none;visibility:hidden}

  /* Main layout */
  .container{max-width:1200px;margin:20px auto;padding:0 16px}
  .hero{border-radius:12px;overflow:hidden;position:relative}
  .hero .slide{height:420px;background-size:cover;background-position:center}
  .hero .caption{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);background:linear-gradient(90deg,rgba(0,0,0,0.55),rgba(0,0,0,0.25));padding:20px;border-radius:10px;text-align:center}
  .hero h1{font-family:Cinzel,serif;color:var(--gold);margin:0;font-size:30px}
  .hero p{margin:10px 0 0;font-size:15px;color:var(--muted)}

  /* Gold widget */
  .gold-row{display:flex;gap:12px;align-items:center;justify-content:center;flex-wrap:wrap;margin-top:18px}
  .gold-box{background:var(--card);padding:12px;border-radius:10px;border:1px solid var(--glass);min-width:220px;text-align:center}

  /* categories */
  .section-title{font-family:Cinzel,serif;color:var(--gold);text-align:center;margin-bottom:12px;font-size:20px}
  .cats{display:flex;gap:12px;overflow:auto;padding:12px 2px}
  .cat{min-width:160px;background:var(--card);border-radius:10px;padding:8px;text-align:center;border:1px solid rgba(255,255,255,0.03)}
  .cat img{height:110px;object-fit:cover;border-radius:8px}

  /* product slider/grid */
  .product-slider{display:flex;gap:12px;overflow:auto;padding:12px 0}
  .product-card{min-width:240px;background:var(--card);border-radius:12px;padding:10px;border:1px solid rgba(255,255,255,0.03)}
  .product-card img{height:180px;object-fit:cover;border-radius:8px}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px;margin-top:18px}

  /* product viewer modal */
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.8);z-index:100005;padding:20px}
  .modal.active{display:flex}
  .modal .box{max-width:1000px;width:100%;background:var(--card);border-radius:12px;padding:18px;display:grid;grid-template-columns:1fr 360px;gap:12px}
  .modal img{width:100%;height:520px;object-fit:contain;border-radius:8px}
  .modal .info{padding:8px;color:var(--text)}
  .zoom{cursor:zoom-in}
  @media(max-width:900px){ .modal .box{grid-template-columns:1fr; } .modal img{height:320px} }

  /* cart drawer */
  .cart-drawer{position:fixed;right:-420px;top:0;width:420px;height:100vh;background:var(--card);border-left:1px solid var(--glass);z-index:100004;padding:18px;transition:right .35s;overflow:auto}
  .cart-drawer.open{right:0}

  /* footer */
  footer{padding:30px 6%;margin-top:40px;border-top:1px solid rgba(255,255,255,0.03);text-align:center}
  footer .small{color:var(--muted);font-size:13px}

  /* controls bottom */
  .float-buttons{position:fixed;right:16px;bottom:16px;display:flex;flex-direction:column;gap:10px;z-index:100006}
  .float-buttons a{display:flex;align-items:center;justify-content:center;width:56px;height:56px;border-radius:50%;background:var(--gold);color:#000;text-decoration:none;font-weight:800;box-shadow:0 8px 30px rgba(0,0,0,0.4)}

  @media(max-width:720px){
    header{padding:10px 4%}
    .logo-row img{height:64px}
    .hero .slide{height:280px}
    #splash img{width:220px}
  }
</style>
</head>
<body>

<!-- ===== SPLASH (logo shows correctly and hides when assets loaded) ===== -->
<div id="splash" role="presentation" aria-hidden="false">
  <div class="splash-inner" role="img" aria-label="Ryaan Jewellers">
    <div class="bgGlow" aria-hidden="true"></div>
    <div class="sparkles" id="sparkles" aria-hidden="true"></div>
    <!-- IMPORTANT: Logo path uses encoded space %20 -->
    <img id="splashLogo" src="" alt="Ryaan Jewellers Logo" />
  </div>
</div>

<!-- ===== HEADER ===== -->
<header>
  <div class="logo-row">
    <img id="headerLogo" src="" alt="Ryaan Jewellers Logo">
    <div>
      <div style="font-weight:700">Ryaan Jewellers</div>
      <div class="small muted" id="tagline" data-en="Gold & Diamonds - Crafted with Love" data-ar="ÿßŸÑÿ∞Ÿáÿ® ŸàÿßŸÑÿ£ŸÑŸÖÿßÿ≥ - ÿµŸÜÿßÿπÿ© ÿ®ÿ≠ÿ®">Gold & Diamonds - Crafted with Love</div>
    </div>
  </div>

  <div class="controls">
    <button id="langToggle" class="ghost">AR</button>
    <button id="themeToggle" class="ghost">Theme</button>
    <button class="btn" onclick="openCart()">Cart (<span id="cartCount">0</span>)</button>
  </div>
</header>

<main class="container" id="main">

  <!-- HERO -->
  <section class="hero" id="home">
    <div class="slide" style="background-image:url('')">
      <div class="caption">
        <h1 data-en="Ryaan Jewellers ‚Äî 18k Gold & Diamonds" data-ar="ÿ±ŸäÿßŸÜ ŸÑŸÖÿ¨ŸàŸáÿ±ÿßÿ™ ‚Äî ÿ∞Ÿáÿ® 18 ŸÇŸäÿ±ÿßÿ∑ Ÿàÿ£ŸÑŸÖÿßÿ≥">Ryaan Jewellers ‚Äî 18k Gold & Diamonds</h1>
        <p data-en="Luxury pieces inspired by top maisons. 18K white, yellow, rose gold." data-ar="ŸÇÿ∑ÿπ ŸÅÿßÿÆÿ±ÿ© ŸÖÿ≥ÿ™Ÿàÿ≠ÿßÿ© ŸÖŸÜ ÿ£ÿ±ŸÇŸâ ÿßŸÑÿØŸàÿ±. ÿ∞Ÿáÿ® 18 ŸÇŸäÿ±ÿßÿ∑ ÿ£ÿ®Ÿäÿ∂ÿå ÿ£ÿµŸÅÿ±ÿå Ÿàÿ±ÿØŸä.">Luxury pieces inspired by top maisons. 18K white, yellow, rose gold.</p>
      </div>
    </div>
  </section>

  <!-- GOLD WIDGET + CHART -->
  <section id="goldWidget" style="margin-top:18px;text-align:center">
    <div class="gold-row">
      <div class="gold-box">
        <div style="font-weight:700;color:var(--gold)">Live UAE Gold Rates</div>
        <div style="margin-top:8px;display:flex;gap:18px;justify-content:center">
          <div><div class="muted">24K</div><div id="g24">--</div></div>
          <div><div class="muted">22K</div><div id="g22">--</div></div>
          <div><div class="muted">18K</div><div id="g18">--</div></div>
        </div>
      </div>
      <div style="min-width:320px;max-width:420px;background:var(--card);padding:12px;border-radius:10px;border:1px solid var(--glass)">
        <canvas id="goldChart" height="100"></canvas>
      </div>
    </div>
  </section>

  <!-- CATEGORIES -->
  <section id="categories" style="margin-top:26px">
    <h3 class="section-title" data-en="Shop by Category" data-ar="ÿ™ÿ≥ŸàŸÇ ÿ≠ÿ≥ÿ® ÿßŸÑŸÅÿ¶ÿ©">Shop by Category</h3>
    <div class="cats" id="categoryList"></div>
  </section>

  <!-- BRANDS -->
  <section id="brands" style="margin-top:20px">
    <h3 class="section-title" data-en="Designer Inspirations" data-ar="ÿ•ŸÑŸáÿßŸÖÿßÿ™ ÿßŸÑŸÖÿµŸÖŸÖŸäŸÜ">Designer Inspirations</h3>
    <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:center">
      <div class="product-card">Chopard</div>
      <div class="product-card">Van Cleef</div>
      <div class="product-card">Cartier</div>
      <div class="product-card">Messika</div>
      <div class="product-card">Boucheron</div>
      <div class="product-card">Marli</div>
    </div>
  </section>

  <!-- PRODUCTS SLIDER -->
  <section id="featured" style="margin-top:26px">
    <h3 class="section-title" data-en="Featured Collection" data-ar="ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ© ÿßŸÑŸÖŸÖŸäÿ≤ÿ©">Featured Collection</h3>
    <div class="product-slider" id="featuredSlider"></div>
  </section>

  <!-- GRID -->
  <section id="shop" style="margin-top:22px">
    <h3 class="section-title" data-en="Shop All" data-ar="ÿ™ÿ≥ŸàŸÇ ÿßŸÑŸÉŸÑ">Shop All</h3>
    <div class="grid" id="productGrid"></div>
  </section>

</main>

<!-- PRODUCT VIEWER MODAL -->
<div id="viewer" class="modal" role="dialog" aria-hidden="true">
  <div class="box" role="document">
    <div>
      <img id="viewerImg" class="zoom" src="" alt="Product view">
      <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap" id="viewerThumbs"></div>
    </div>
    <div class="info">
      <h2 id="viewerTitle"></h2>
      <p id="viewerMeta" class="muted"></p>
      <p id="viewerDesc"></p>
      <div style="margin-top:10px;display:flex;gap:8px">
        <button class="btn" onclick="addToCart(viewerCurrentId)">Add to cart</button>
        <button class="ghost" onclick="startCheckout()">Buy Now</button>
      </div>
      <div style="margin-top:12px">
        <small class="muted">360¬∞ viewer placeholder (if you add 360 images, they will show here)</small>
      </div>
      <div style="margin-top:18px">
        <button class="ghost" onclick="closeViewer()">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- CART DRAWER -->
<div id="cartDrawer" class="cart-drawer" aria-hidden="true">
  <h3 data-en="Your Cart" data-ar="ÿ≥ŸÑÿ™ŸÉ">Your Cart</h3>
  <div id="cartItems"></div>
  <div style="margin-top:12px">
    <div style="display:flex;justify-content:space-between"><div class="muted" data-en="Subtotal" data-ar="ÿßŸÑŸÖÿ¨ŸÖŸàÿπ">Subtotal</div><div id="cartSubtotal">AED 0.00</div></div>
    <div style="display:flex;gap:8px;margin-top:10px">
      <button class="btn" style="flex:1" onclick="startCheckout()">Checkout</button>
      <button class="ghost" style="flex:1" onclick="clearCart()">Clear</button>
    </div>
    <div style="margin-top:8px" class="muted">Payments via Stripe (serverless) or WhatsApp order</div>
  </div>
  <div style="margin-top:18px"><button class="ghost" onclick="closeCart()">Close</button></div>
</div>

<!-- Floating contact buttons -->
<div class="float-buttons">
  <a title="WhatsApp" href="https://wa.me/971543746476" target="_blank">WA</a>
  <a title="Instagram" href="https://instagram.com/ryaanjewellers007" target="_blank">IG</a>
</div>

<!-- FOOTER -->
<footer>
  <img id="footerLogo" src="" alt="Ryaan logo" style="height:70px">
  <p class="small">Ryaan Jewellers ‚Ä¢ Gold & Diamonds ‚Äî Crafted with Love & Precious üíé ‚ú®</p>
  <p class="small">Address: Dubai, UAE ‚Ä¢ Email: <a href="mailto:ryaanjewellers@gmail.com">ryaanjewellers@gmail.com</a> ‚Ä¢ Phone: +971543746476</p>
  <p class="small">¬© 2025 Ryaan Jewellers</p>
</footer>

<script>
/* =========================
   CONFIG ‚Äî adjust if needed
   ========================= */
const RAW_BASE = "https://raw.githubusercontent.com/ryaanjewellers007/Ryaanjewellers/main/";
// if your repo path is different, change the RAW_BASE above (case-sensitive)

// encoded logo filename
const LOGO_FILE_ENCODED = "Logo%20new%20ryaan.png";

// product files (S_1 .. S_13) expected in repo root
const PRODUCTS = [
  {id:'P100',title_en:'Chic Lattice - Yellow 18K',title_ar:'Chic Lattice - ÿ£ÿµŸÅÿ± 18K',img:'S_1.jpg',purity:18,weight:6,cat:'rings',desc_en:'Elegant lattice ring',desc_ar:'ÿÆÿßÿ™ŸÖ ÿ¥ÿ®ŸÉŸä ÿ£ŸÜŸäŸÇ'},
  {id:'P101',title_en:'Maison Classic - White 18K',title_ar:'Maison Classic - ÿ£ÿ®Ÿäÿ∂ 18K',img:'S_2.jpg',purity:18,weight:7,cat:'necklaces',desc_en:'Classic maison necklace',desc_ar:'ŸÇŸÑÿßÿØÿ© ŸÉŸÑÿßÿ≥ŸäŸÉŸäÿ©'},
  {id:'P102',title_en:'√âclat Diamond - Rose 18K',title_ar:'√âclat Diamond - Ÿàÿ±ÿØŸä 18K',img:'S_3.jpg',purity:18,weight:5,cat:'bracelets',desc_en:'Diamond bracelet',desc_ar:'ÿßÿ≥Ÿàÿ±ÿ© ÿßŸÑŸÖÿßÿ≥'},
  {id:'P103',title_en:'Royal Motif - Yellow 18K',title_ar:'Royal Motif - ÿ£ÿµŸÅÿ± 18K',img:'S_4.jpg',purity:18,weight:8,cat:'earrings',desc_en:'Royal motif earrings',desc_ar:'ÿ£ŸÇÿ±ÿßÿ∑ ÿ®ÿ∑ÿßÿ®ÿπ ŸÖŸÑŸÉŸä'},
  {id:'P104',title_en:'Petite √âtoile - White 18K',title_ar:'Petite √âtoile - ÿ£ÿ®Ÿäÿ∂ 18K',img:'S_5.jpg',purity:18,weight:9,cat:'rings',desc_en:'Star motif ring',desc_ar:'ÿÆÿßÿ™ŸÖ ŸÜÿ¨ŸÖŸä'},
  {id:'P105',title_en:'Aurora Braid - Rose 18K',title_ar:'Aurora Braid - Ÿàÿ±ÿØŸä 18K',img:'S_6.jpg',purity:18,weight:10,cat:'necklaces',desc_en:'Braid necklace',desc_ar:'ŸÇŸÑÿßÿØÿ© ŸÖÿ∂ŸÅÿ±ÿ©'},
  {id:'P106',title_en:'Celeste Drop - Yellow 18K',title_ar:'Celeste Drop - ÿ£ÿµŸÅÿ± 18K',img:'S_7.jpg',purity:18,weight:6,cat:'bracelets',desc_en:'Drop bracelet',desc_ar:'ÿßÿ≥Ÿàÿ±ÿ© ŸÖÿ™ÿØŸÑŸäÿ©'},
  {id:'P107',title_en:'Opal Curve - White 18K',title_ar:'Opal Curve - ÿ£ÿ®Ÿäÿ∂ 18K',img:'S_8.jpg',purity:18,weight:11,cat:'earrings',desc_en:'Opal earrings',desc_ar:'ÿ£ŸÇÿ±ÿßÿ∑ ÿπŸÇŸäŸÇ'},
  {id:'P108',title_en:'Luna Band - Rose 18K',title_ar:'Luna Band - Ÿàÿ±ÿØŸä 18K',img:'S_9.jpg',purity:18,weight:12,cat:'rings',desc_en:'Luna band',desc_ar:'ÿÆÿßÿ™ŸÖ ŸÑŸàŸÜÿß'},
  {id:'P109',title_en:'Velvet Hoop - Yellow 18K',title_ar:'Velvet Hoop - ÿ£ÿµŸÅÿ± 18K',img:'S_10.jpg',purity:18,weight:7,cat:'necklaces',desc_en:'Velvet hoop necklace',desc_ar:'ŸÇŸÑÿßÿØÿ© ÿ≠ŸÑŸÇÿ© ŸÖÿÆŸÖŸÑŸäÿ©'},
  {id:'P110',title_en:'Regal Chain - White 18K',title_ar:'Regal Chain - ÿ£ÿ®Ÿäÿ∂ 18K',img:'S_11.jpg',purity:18,weight:14,cat:'bracelets',desc_en:'Regal chain',desc_ar:'ÿ≥ŸÑÿ≥ŸÑÿ© ŸÖŸÑŸÉŸäÿ©'},
  {id:'P111',title_en:'Solitaire Muse - Rose 18K',title_ar:'Solitaire Muse - Ÿàÿ±ÿØŸä 18K',img:'S_12.jpg',purity:18,weight:5,cat:'earrings',desc_en:'Solitaire studs',desc_ar:'ŸÖÿ≥ÿßŸÖŸäÿ± Ÿàÿ≠ŸäÿØÿ©'},
  {id:'P112',title_en:'Marli Twist - Yellow 18K',title_ar:'Marli Twist - ÿ£ÿµŸÅÿ± 18K',img:'S_13.jpg',purity:18,weight:13,cat:'necklaces',desc_en:'Twist necklace',desc_ar:'ŸÇŸÑÿßÿØÿ© ŸÖŸÑÿ™ŸàŸäÿ©'}
];

/* build full raw url for an asset */
function asset(path){ 
  // if path already looks like a full URL, return it
  if(/^https?:\/\//i.test(path)) return path;
  // ensure RAW_BASE ends with '/'
  const base = RAW_BASE.endsWith('/') ? RAW_BASE : RAW_BASE + '/';
  return base + encodeURIComponent(path).replace(/%2F/g, '/');
}

/* ---------- Splash logic: show logo and hide when assets ready ---------- */
(function setupSplash(){
  const splashLogo = document.getElementById('splashLogo');
  const headerLogo = document.getElementById('headerLogo');
  const footerLogo = document.getElementById('footerLogo');
  const homeSlide = document.querySelector('.hero .slide');

  // set logo src (encoded filename)
  const logoUrl = RAW_BASE + LOGO_FILE_ENCODED;
  [splashLogo, headerLogo, footerLogo].forEach(el=>{
    if(el) el.src = logoUrl;
    // fallback text if image fails
    el.onerror = function(){
      if(el.tagName.toLowerCase()==='img') el.style.display='none';
      // put a text fallback
      const fallback = document.createElement('div');
      fallback.style.color = 'var(--gold)';
      fallback.style.fontWeight = '800';
      fallback.style.fontFamily = 'Cinzel, serif';
      fallback.innerText = 'Ryaan Jewellers';
      el.parentNode && el.parentNode.insertBefore(fallback, el.nextSibling);
    }
  });

  // set hero background to first product image
  const firstImg = asset(PRODUCTS[0].img);
  if(homeSlide) homeSlide.style.backgroundImage = `url('${firstImg}')`;

  // build sparkles
  const wrap = document.getElementById('sparkles');
  const coords = [{l:'12%',t:'18%'},{l:'68%',t:'22%'},{l:'36%',t:'72%'},{l:'82%',t:'64%'},{l:'22%',t:'58%'},{l:'56%',t:'42%'}];
  if(wrap) coords.forEach((c,i)=>{
    const s = document.createElement('span');
    s.style.left=c.l; s.style.top=c.t; s.style.position='absolute';
    s.style.animationDelay = (i*0.15)+'s';
    wrap.appendChild(s);
  });

  // hide splash when main images loaded or after timeout
  let loaded = false;
  function tryHide(){ if(loaded) return; loaded = true; setTimeout(()=> document.getElementById('splash').classList.add('hide'), 350); }
  // if logo loads, hide
  splashLogo.onload = tryHide;
  // also hide after 2200ms guaranteed
  setTimeout(tryHide, 2200);
})();

/* ---------- Language toggle: translate all [data-en]/[data-ar] ---------- */
function applyLanguage(lang){
  document.documentElement.lang = (lang==='ar') ? 'ar' : 'en';
  document.querySelectorAll('[data-en]').forEach(el=>{
    const en = el.getAttribute('data-en'), ar = el.getAttribute('data-ar') || en;
    el.innerText = (lang==='ar') ? ar : en;
  });
  // adjust direction
  document.documentElement.dir = (lang==='ar') ? 'rtl' : 'ltr';
  localStorage.setItem('ry_lang', lang);
}
document.getElementById('langToggle').addEventListener('click', ()=>{
  const next = (localStorage.getItem('ry_lang')==='ar') ? 'en' : 'ar';
  applyLanguage(next);
  // update button text
  document.getElementById('langToggle').innerText = (next==='ar') ? 'EN' : 'AR';
});
// initialize language
(function(){ const l = localStorage.getItem('ry_lang') || 'en'; applyLanguage(l); document.getElementById('langToggle').innerText = (l==='ar') ? 'EN' : 'AR'; })();

/* ---------- Theme toggle ---------- */
document.getElementById('themeToggle').addEventListener('click', ()=>{
  const cur = document.documentElement.getAttribute('data-theme');
  if(cur==='light'){ document.documentElement.removeAttribute('data-theme'); localStorage.setItem('ry_theme','dark'); }
  else { document.documentElement.setAttribute('data-theme','light'); localStorage.setItem('ry_theme','light'); }
});
if(localStorage.getItem('ry_theme')==='light') document.documentElement.setAttribute('data-theme','light');

/* ---------- Gold price engine (public fallback + simulated updates) ---------- */
let goldHistory = [];
let base24 = 500.00; // default AED/g ‚Äî you can update this dynamically by calling updateBase(value)

function updateBase(v){ base24 = Number(v); updateGoldUI(); }

function updateGoldUI(){
  const p24 = Number(base24);
  const p22 = p24 * (22/24);
  const p18 = p24 * (18/24);
  document.getElementById('g24').innerText = p24.toFixed(2);
  document.getElementById('g22').innerText = p22.toFixed(2);
  document.getElementById('g18').innerText = p18.toFixed(2);
  pushGoldPoint(p24);
}

/* chart */
const ctx = document.getElementById('goldChart').getContext('2d');
const chartData = {labels:[],datasets:[{label:'24K AED/g',data:[],borderColor: '#D4AF37',backgroundColor:'rgba(212,175,55,0.08)',tension:0.3}]};
const goldChart = new Chart(ctx,{type:'line',data:chartData,options:{plugins:{legend:{display:false}},scales:{x:{display:false}}}});

function pushGoldPoint(v){
  const t = new Date().toLocaleTimeString();
  chartData.labels.push(t);
  chartData.datasets[0].data.push(Number(v.toFixed(2)));
  if(chartData.labels.length>20){ chartData.labels.shift(); chartData.datasets[0].data.shift(); }
  goldChart.update();
}

/* simulate small market movement every 35s */
setInterval(()=>{ base24 = base24*(1 + (Math.random()-0.5)*0.004); updateGoldUI(); }, 35000);
updateGoldUI();

/* ---------- Build categories, featured slider, grid ---------- */
function buildCategories(){
  const cats = [...new Set(PRODUCTS.map(p=>p.cat))];
  const el = document.getElementById('categoryList');
  el.innerHTML = '';
  cats.forEach(c=>{
    const p = PRODUCTS.find(x=>x.cat===c);
    const d = document.createElement('div'); d.className='cat';
    const img = document.createElement('img'); img.src = asset(p.img); img.alt = c; img.onerror = ()=>img.style.opacity=0.4;
    d.appendChild(img);
    const t = document.createElement('div'); t.style.marginTop='8px'; t.style.fontWeight='700'; t.style.color='var(--gold)'; t.innerText = (localStorage.getItem('ry_lang')==='ar') ? (p.title_ar || p.title_en) : p.title_en;
    d.appendChild(t);
    d.addEventListener('click', ()=> filterGrid(c));
    el.appendChild(d);
  });
}

function buildFeatured(){
  const out = document.getElementById('featuredSlider'); out.innerHTML='';
  PRODUCTS.slice(0,8).forEach(p=>{
    const card = document.createElement('div'); card.className='product-card';
    const img = document.createElement('img'); img.src = asset(p.img); img.alt = p.title_en; img.onerror = ()=>img.style.opacity=0.5;
    card.appendChild(img);
    const title = document.createElement('div'); title.style.marginTop='8px'; title.style.fontWeight='700'; title.style.color='var(--gold)'; title.innerText = (localStorage.getItem('ry_lang')==='ar') ? p.title_ar : p.title_en;
    card.appendChild(title);
    const meta = document.createElement('div'); meta.className='muted'; meta.innerText = `${p.purity}K ‚Ä¢ ${p.weight}g`; card.appendChild(meta);
    const btnWrap = document.createElement('div'); btnWrap.style.marginTop='8px';
    const btn = document.createElement('button'); btn.className='btn'; btn.innerText = (localStorage.getItem('ry_lang')==='ar') ? 'ÿπÿ±ÿ∂' : 'View'; btn.onclick = ()=>openViewer(p.id);
    btnWrap.appendChild(btn);
    card.appendChild(btnWrap);
    out.appendChild(card);
  });
}

function buildGrid(list){
  const out = document.getElementById('productGrid'); out.innerHTML = '';
  (list || PRODUCTS).forEach(p=>{
    const el = document.createElement('div'); el.className='product-card';
    el.innerHTML = `<img src="${asset(p.img)}" alt="${p.title_en}" onerror="this.style.opacity=.4;"><div style="margin-top:8px;font-weight:700;color:var(--gold)">${localStorage.getItem('ry_lang')==='ar'?p.title_ar:p.title_en}</div><div class="muted">${p.purity}K ‚Ä¢ ${p.weight}g</div><div style="margin-top:8px;display:flex;gap:8px"><button class="btn" style="flex:1" onclick="addToCart('${p.id}')">Add</button><button class="ghost" style="flex:1" onclick="openViewer('${p.id}')">Quick View</button></div>`;
    out.appendChild(el);
  });
}

function filterGrid(cat){
  const filtered = PRODUCTS.filter(p=>p.cat===cat);
  buildGrid(filtered);
}

/* ---------- Viewer modal ---------- */
let viewerCurrentId = null;
function openViewer(id){
  const p = PRODUCTS.find(x=>x.id===id); if(!p) return;
  viewerCurrentId = id;
  document.getElementById('viewerImg').src = asset(p.img);
  document.getElementById('viewerTitle').innerText = (localStorage.getItem('ry_lang')==='ar'?p.title_ar:p.title_en);
  document.getElementById('viewerMeta').innerText = `${p.purity}K ‚Ä¢ ${p.weight}g`;
  document.getElementById('viewerDesc').innerText = (localStorage.getItem('ry_lang')==='ar'?p.desc_ar:p.desc_en);
  // thumbs (placeholder duplicates)
  const thumbs = document.getElementById('viewerThumbs'); thumbs.innerHTML = '';
  for(let i=0;i<3;i++){
    const t = document.createElement('img'); t.src = asset(p.img); t.style.width='70px'; t.style.height='70px'; t.style.objectFit='cover'; t.style.borderRadius='6px'; t.style.cursor='pointer';
    t.onclick = ()=> document.getElementById('viewerImg').src = asset(p.img);
    thumbs.appendChild(t);
  }
  document.getElementById('viewer').classList.add('active');
  document.getElementById('viewer').setAttribute('aria-hidden','false');
}

function closeViewer(){
  document.getElementById('viewer').classList.remove('active');
  document.getElementById('viewer').setAttribute('aria-hidden','true');
}

/* zoom toggle on viewer image (simple) */
document.addEventListener('click', function(e){
  if(e.target && e.target.id==='viewerImg'){
    e.target.classList.toggle('zoomed');
    if(e.target.classList.contains('zoomed')){ e.target.style.transform='scale(1.6)'; e.target.style.cursor='zoom-out'; } else { e.target.style.transform='scale(1)'; e.target.style.cursor='zoom-in'; }
  }
});

/* ---------- Cart (localStorage) ---------- */
function getCart(){ return JSON.parse(localStorage.getItem('ry_cart')||'[]'); }
function saveCart(c){ localStorage.setItem('ry_cart',JSON.stringify(c)); renderCart(); updateCartCount(); }
function addToCart(pid){
  const item = getCart().find(x=>x.id===pid);
  if(item) item.qty += 1; else getCart().push && getCart(); // avoid accidental wrong mutation
  const cart = getCart();
  const found = cart.find(x=>x.id===pid);
  if(found) found.qty++; else cart.push({id:pid,qty:1});
  saveCart(cart);
  alert((localStorage.getItem('ry_lang')==='ar') ? 'ÿ™ŸÖÿ™ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ© ÿ•ŸÑŸâ ÿßŸÑÿ≥ŸÑÿ©' : 'Added to cart');
}
function clearCart(){ saveCart([]); }

function renderCart(){
  const holder = document.getElementById('cartItems'); if(!holder) return;
  const cart = getCart();
  holder.innerHTML = '';
  let subtotal = 0;
  if(cart.length===0){ holder.innerHTML = `<div class="muted">${localStorage.getItem('ry_lang')==='ar'?'ÿ≥ŸÑÿ© ÿßŸÑÿ™ÿ≥ŸàŸÇ ŸÅÿßÿ±ÿ∫ÿ©':'Your cart is empty'}</div>`; document.getElementById('cartSubtotal').innerText='AED 0.00'; updateCartCount(); return; }
  cart.forEach(it=>{
    const p = PRODUCTS.find(x=>x.id===it.id); if(!p) return;
    const price = computePrice(p);
    subtotal += price * it.qty;
    const div = document.createElement('div'); div.style.display='flex'; div.style.justifyContent='space-between'; div.style.alignItems='center'; div.style.marginBottom='10px';
    div.innerHTML = `<div><div style="font-weight:700">${localStorage.getItem('ry_lang')==='ar'?p.title_ar:p.title_en}</div><div class="muted">${p.purity}K ‚Ä¢ ${p.weight}g</div><div class="muted">Qty: ${it.qty}</div></div><div style="text-align:right"><div style="font-weight:800;color:var(--gold)">AED ${ (price*it.qty).toFixed(2) }</div><div style="margin-top:6px"><button class="ghost" onclick="changeQty('${p.id}',-1)">-</button><button class="ghost" onclick="changeQty('${p.id}',1)">+</button></div></div>`;
    holder.appendChild(div);
  });
  document.getElementById('cartSubtotal').innerText = 'AED ' + subtotal.toFixed(2);
  updateCartCount();
}
function changeQty(pid,delta){
  const cart = getCart(); const it = cart.find(x=>x.id===pid); if(!it) return;
  it.qty += delta; if(it.qty<=0){ const idx = cart.findIndex(x=>x.id===pid); cart.splice(idx,1); }
  saveCart(cart);
}
function updateCartCount(){
  const count = getCart().reduce((s,i)=>s+i.qty,0);
  document.getElementById('cartCount').innerText = count;
}

/* price compute: simple: per gram * grams * purity/24 + markup */
function computePrice(p){
  const perGram = base24; const purity = p.purity || 18; const grams = p.weight || 1;
  const base = perGram * grams * (purity/24);
  return Number((base * 1.12).toFixed(2)); // 12% markup
}

/* open/close cart */
function openCart(){ document.getElementById('cartDrawer').classList.add('open'); document.getElementById('cartDrawer').setAttribute('aria-hidden','false'); renderCart(); }
function closeCart(){ document.getElementById('cartDrawer').classList.remove('open'); document.getElementById('cartDrawer').setAttribute('aria-hidden','true'); }

/* ---------- Checkout (placeholder to integrate Stripe serverless) ---------- */
async function startCheckout(){
  const cart = getCart();
  if(cart.length===0){ alert((localStorage.getItem('ry_lang')==='ar')?'ÿßŸÑÿ≥ŸÑÿ© ŸÅÿßÿ±ÿ∫ÿ©':'Cart is empty'); return; }
  // You should create a serverless endpoint that creates a Stripe Checkout session.
  // If you deploy /api/create-checkout-session on Vercel, set VERCEL_API_BASE variable in this file to your Vercel domain.
  const VERCEL_API_BASE = window.VERCEL_API_BASE || ''; // set if needed
  const url = VERCEL_API_BASE ? `${VERCEL_API_BASE}/api/create-checkout-session` : '/api/create-checkout-session';
  try{
    const items = cart.map(it => {
      const p = PRODUCTS.find(x=>x.id===it.id);
      return { name: (localStorage.getItem('ry_lang')==='ar'?p.title_ar:p.title_en), unit_amount_aed: computePrice(p), quantity: it.qty, image: asset(p.img) };
    });
    const res = await fetch(url, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ items }) });
    const data = await res.json();
    if(res.ok && data.sessionId){
      const stripeKey = window.STRIPE_PUBLISHABLE_KEY || ''; // set this after you deploy
      if(!stripeKey) return alert('Stripe not configured (publishable key missing)');
      const stripe = Stripe(stripeKey);
      await stripe.redirectToCheckout({ sessionId: data.sessionId });
    } else {
      console.warn('checkout error', data);
      // fallback: open WhatsApp order with cart summary
      let msg = `Order from Ryaan Jewellers%0A%0A`;
      cart.forEach(it=>{ const p = PRODUCTS.find(x=>x.id===it.id); msg += `${p.title_en} x${it.qty} - AED ${computePrice(p)*it.qty}%0A`; });
      msg += `%0ATotal: AED ${cart.reduce((s,i)=>s+computePrice(PRODUCTS.find(p=>p.id===i.id))*i.qty,0).toFixed(2)}`;
      window.open('https://wa.me/971543746476?text=' + encodeURIComponent(msg), '_blank');
    }
  }catch(e){
    console.error(e);
    alert('Checkout error ‚Äî falling back to WhatsApp order');
    let msg = `Order from Ryaan Jewellers%0A%0A`;
    getCart().forEach(it=>{ const p = PRODUCTS.find(x=>x.id===it.id); msg += `${p.title_en} x${it.qty} - AED ${computePrice(p)*it.qty}%0A`; });
    window.open('https://wa.me/971543746476?text=' + encodeURIComponent(msg), '_blank');
  }
}

/* ---------- Instagram slider (simple) ---------- */
function buildInstagram(){
  const images = [
    'Screenshot_20251129_014405_Chrome.jpg',
    'Screenshot_20251129_014443_Chrome.jpg',
    'Screenshot_20251129_014511_Chrome.jpg'
  ];
  const slider = document.createElement('div'); slider.style.display='flex'; slider.style.gap='8px'; slider.style.overflow='auto'; slider.style.marginTop='12px';
  images.forEach(img=>{
    const el = document.createElement('img'); el.src = asset(img); el.style.width='150px'; el.style.height='150px'; el.style.objectFit='cover'; el.style.borderRadius='8px'; el.onclick = ()=> window.open('https://instagram.com/ryaanjewellers007','_blank');
    slider.appendChild(el);
  });
  document.querySelector('#featured') && document.querySelector('#featured').appendChild(slider);
}

/* ---------- Utilities ---------- */
function asset(p){ return RAW_BASE + encodeURIComponent(p).replace(/%2F/g,'/'); }

/* ---------- Init on DOM load ---------- */
document.addEventListener('DOMContentLoaded', ()=>{
  buildCategories();
  buildFeatured();
  buildGrid();
  buildInstagram();
  renderCart();
  updateCartCount();
});
</script>
</body>
</html>
