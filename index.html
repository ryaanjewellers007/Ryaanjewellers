<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ryaan Jewellers — Gold & Diamonds - Crafted with Love & Precious</title>
<meta name="description" content="Ryaan Jewellers — 18k Gold White Yellow Rose inspired versions. Master copy luxury jewellery. Dubai. Live UAE gold rates.">
<meta name="keywords" content="Ryaan Jewellers, 18k, gold, diamonds, Dubai, jewellery, Cartier, Messika, Van Cleef" />
<meta name="theme-color" content="#000000" />
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<!-- JSON-LD for SEO -->
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"Store",
  "name":"Ryaan Jewellers",
  "image":["https://raw.githubusercontent.com/ryaanjewellers007/Ryaanjewellers007/main/Logo%20new%20ryaan.png"],
  "telephone":"+971543746476",
  "email":"ryaanjewellers@gmail.com",
  "address":{"@type":"PostalAddress","addressLocality":"Dubai","addressCountry":"AE"},
  "description":"Ryaan Jewellers — Gold & Diamonds - Crafted with Love & Precious. 18k Gold White Yellow Rose inspired versions."
}
</script>

<style>
  :root{
    --bg:#050405; --card:#0f0f12; --text:#f7f7f7; --muted:#cfcfcf; --gold:#D4AF37;
    --glass: rgba(255,255,255,0.03);
  }
  :root[data-theme="light"]{
    --bg:#ffffff; --card:#ffffff; --text:#111; --muted:#444; --gold:#b8860b; --glass: rgba(0,0,0,0.04);
  }

  *{box-sizing:border-box}
  body{margin:0;font-family:'Poppins',sans-serif;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}
  a{color:inherit; text-decoration:none}
  .container{max-width:1200px;margin:0 auto;padding:18px}

  /* header */
  header{position:sticky;top:0;z-index:999;background:linear-gradient(180deg, rgba(0,0,0,0.55), rgba(0,0,0,0.2));backdrop-filter:blur(6px);border-bottom:1px solid rgba(212,175,55,0.06)}
  .nav{max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;padding:12px}
  .logo img{height:96px;object-fit:contain;filter:drop-shadow(0 18px 60px rgba(212,175,55,0.12))}
  .navlinks{display:flex;gap:12px;align-items:center}
  .navlinks a{padding:8px 10px;border-radius:8px;font-weight:600}
  .btn{background:var(--gold);color:#111;padding:8px 12px;border-radius:8px;border:none;font-weight:700;cursor:pointer}
  .smallbtn{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--text);padding:8px;border-radius:8px;cursor:pointer}

  /* SPLASH */
  #splash{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:#000;z-index:100000;transition:opacity .9s,visibility .9s}
  .splash-inner{position:relative;width:520px;height:520px;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-direction:column}
  .splash-inner .bg{position:absolute;inset:-20%;border-radius:50%;filter:blur(60px);background:radial-gradient(circle at 30% 20%, rgba(212,175,55,0.12), transparent 40%);z-index:1}
  .splash-inner img{width:300px;z-index:2;border-radius:12px}
  .splash-spark{position:absolute;inset:0;z-index:3;pointer-events:none}
  .splash-spark span{position:absolute;width:6px;height:6px;border-radius:50%;background:radial-gradient(circle,#fff,#D4AF37);opacity:0;filter:blur(0.6px);animation:tw 2.6s infinite ease-in-out}
  @keyframes tw{0%{transform:scale(.6);opacity:0}35%{opacity:1;transform:scale(1.1)}60%{opacity:.6;transform:scale(.9)}100%{opacity:0;transform:scale(.6)}}
  .splash-text{z-index:4;margin-top:18px;color:var(--muted);font-size:14px}
  .hide-splash{opacity:0;pointer-events:none;visibility:hidden}

  /* hero */
  .hero{max-width:1200px;margin:26px auto;border-radius:14px;overflow:hidden;position:relative}
  .hero .slide{height:460px;background-size:cover;background-position:center;display:flex;align-items:center;justify-content:center}
  .hero .caption{background:linear-gradient(90deg, rgba(0,0,0,0.6), rgba(0,0,0,0.25));padding:24px;border-radius:10px;text-align:center}
  .hero h1{font-family:Cinzel,serif;color:var(--gold);margin:0;font-size:34px}
  .hero p{margin:8px 0 0 0;color:var(--muted)}

  /* sections */
  .section-title{font-family:Cinzel,serif;color:var(--gold);font-size:22px;text-align:center;margin-bottom:12px}
  .cats{display:flex;gap:12px;overflow:auto;padding-bottom:8px}
  .cat{min-width:170px;background:var(--card);border-radius:10px;padding:10px;text-align:center;border:1px solid rgba(212,175,55,0.06)}
  .cat img{width:100%;height:110px;object-fit:cover;border-radius:8px}

  /* product slider / grid */
  .product-slider{display:flex;gap:12px;overflow:auto;padding:12px 0}
  .product{min-width:260px;background:var(--card);border-radius:12px;padding:12px;border:1px solid rgba(255,255,255,0.03)}
  .product img{width:100%;height:200px;object-fit:cover;border-radius:8px}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px;margin-top:18px}

  /* cart drawer */
  #cartDrawer{position:fixed;top:0;right:-460px;width:420px;height:100vh;background:var(--card);border-left:1px solid rgba(212,175,55,0.08);box-shadow:-6px 0 30px rgba(0,0,0,0.6);padding:20px;transition:right .35s;z-index:100001;overflow-y:auto}
  #cartDrawer.open{right:0}
  .cart-item{display:flex;gap:10px;align-items:center;padding:10px 0;border-bottom:1px solid rgba(255,255,255,0.03)}

  /* modal */
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:100002}
  .modal.open{display:flex}
  .modal-box{background:var(--card);padding:18px;border-radius:12px;width:94%;max-width:640px}

  /* footer */
  footer{margin-top:28px;padding:28px 0;background:#000;border-top:1px solid rgba(212,175,55,0.08);text-align:center}
  footer img{height:72px;filter:drop-shadow(0 8px 30px rgba(212,175,55,0.12))}

  @media(max-width:900px){
    .logo img{height:72px}
    .hero .slide{height:320px}
    .splash-inner img{width:220px}
    #cartDrawer{width:100%}
  }
</style>
</head>
<body>

<!-- SPLASH -->
<div id="splash" aria-hidden="false">
  <div class="splash-inner" role="img" aria-label="Ryaan Jewellers Splash">
    <div class="bg" aria-hidden="true"></div>
    <!-- image loaded via JS (attempts multiple raw paths) -->
    <img id="splashLogo" alt="Ryaan Jewellers Logo">
    <div class="splash-spark" id="splashSpark"></div>
    <div class="splash-text" id="splashText">Ryaan Jewellers — Gold & Diamonds - Crafted with Love</div>
  </div>
</div>

<!-- HEADER -->
<header>
  <div class="nav" role="navigation" aria-label="Main navigation">
    <div class="logo">
      <img id="headerLogo" alt="Ryaan logo">
      <div style="display:flex;flex-direction:column;justify-content:center">
        <div style="font-weight:700">Ryaan Jewellers</div>
        <div class="muted" style="font-size:12px">Gold & Diamonds - Crafted with Love & Precious</div>
      </div>
    </div>

    <div style="display:flex;align-items:center;gap:10px">
      <div class="navlinks" id="navLinks">
        <a href="#home" data-en="Home" data-ar="الرئيسية">Home</a>
        <a href="#categories" data-en="Categories" data-ar="الفئات">Categories</a>
        <a href="#products" data-en="Products" data-ar="المنتجات">Products</a>
        <a href="#gold" data-en="Gold Rates" data-ar="أسعار الذهب">Gold Rates</a>
        <a href="#contact" data-en="Contact" data-ar="اتصل">Contact</a>
      </div>

      <button class="smallbtn" id="langToggle">AR</button>
      <button class="smallbtn" id="themeToggle">☾</button>
      <button class="btn" onclick="toggleCart()">Cart</button>
    </div>
  </div>
</header>

<!-- HERO -->
<section id="home" class="hero">
  <div class="slide" id="heroSlide" style="background-image:url('');">
    <div class="caption">
      <h1 data-en="Ryaan Jewellers — 18k Gold & Diamond Luxury" data-ar="ريان مجوهرات — فخامة ذهب و ألماس 18 قيراط">Ryaan Jewellers — 18k Gold & Diamond Luxury</h1>
      <p data-en="Crafted with love & precious — White | Yellow | Rose" data-ar="مصنوع بحب وبأحجار ثمينة — أبيض | أصفر | وردي">Crafted with love & precious — White | Yellow | Rose</p>
    </div>
  </div>
</section>

<div class="container">

  <!-- GOLD RATES + CHART -->
  <section id="gold" style="margin-top:18px;display:grid;grid-template-columns:1fr 360px;gap:12px;align-items:start">
    <div style="background:linear-gradient(180deg,#0b0b0b,#0e0e0e);padding:16px;border-radius:12px;border:1px solid rgba(212,175,55,0.06)">
      <div style="font-family:Cinzel,serif;color:var(--gold);font-size:18px" data-en="Live UAE Gold Rates (AED / g)" data-ar="أسعار الذهب في الإمارات (درهم/غرام)">Live UAE Gold Rates (AED / g)</div>
      <div style="display:flex;gap:12px;margin-top:12px;flex-wrap:wrap">
        <div style="min-width:110px"><div class="muted">24K</div><div style="font-weight:800;color:var(--gold);font-size:18px" id="g24">--</div></div>
        <div style="min-width:110px"><div class="muted">22K</div><div style="font-weight:800;color:var(--gold);font-size:18px" id="g22">--</div></div>
        <div style="min-width:110px"><div class="muted">18K</div><div style="font-weight:800;color:var(--gold);font-size:18px" id="g18">--</div></div>
      </div>
      <div style="margin-top:10px;font-size:13px;color:var(--muted)" data-en="Prices auto-refresh every 30s. Source: public fallback or your Vercel API." data-ar="تُحدّث الأسعار تلقائياً كل 30 ثانية. المصدر: بيانات عامة أو API خاص بك.">Prices auto-refresh every 30s. Source: public fallback or your Vercel API.</div>
    </div>
    <div style="background:var(--card);padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)">
      <div style="font-family:Cinzel,serif;color:var(--gold);font-size:15px" data-en="24K — Recent" data-ar="24 قيراط — آخر التحديثات">24K — Recent</div>
      <canvas id="goldChart" width="340" height="160" style="width:100%;height:140px;margin-top:8px"></canvas>
      <div style="display:flex;justify-content:space-between;margin-top:8px;font-size:12px;color:var(--muted)"><div id="goldUpdated">--</div><button class="smallbtn" onclick="fetchGold(true)" data-en="Refresh" data-ar="تحديث">Refresh</button></div>
    </div>
  </section>

  <!-- CATEGORIES -->
  <section id="categories" style="margin-top:26px">
    <h3 class="section-title" data-en="Shop by Category" data-ar="تسوق حسب الفئة">Shop by Category</h3>
    <div class="cats" id="categoryRow"></div>
  </section>

  <!-- BRANDED SECTIONS -->
  <section id="brands" style="margin-top:20px">
    <h3 class="section-title" data-en="Designer Inspirations" data-ar="إلهامات الماركات">Designer Inspirations</h3>
    <div style="display:flex;gap:12px;flex-wrap:wrap;justify-content:center">
      <div style="padding:12px;border-radius:8px;background:var(--card);border:1px solid rgba(212,175,55,0.06)">Cartier</div>
      <div style="padding:12px;border-radius:8px;background:var(--card);border:1px solid rgba(212,175,55,0.06)">Van Cleef</div>
      <div style="padding:12px;border-radius:8px;background:var(--card);border:1px solid rgba(212,175,55,0.06)">Messika</div>
      <div style="padding:12px;border-radius:8px;background:var(--card);border:1px solid rgba(212,175,55,0.06)">Chopard</div>
    </div>
  </section>

  <!-- PRODUCT SLIDER -->
  <section id="products" style="margin-top:26px">
    <h3 class="section-title" data-en="Featured Collection" data-ar="المجموعة المميزة">Featured Collection</h3>
    <div class="product-slider" id="productSlider" aria-live="polite"></div>
  </section>

  <!-- SHOP GRID -->
  <section style="margin-top:24px">
    <h3 class="section-title" data-en="Shop All" data-ar="تسوق الكل">Shop All</h3>
    <div class="grid" id="productGrid"></div>
  </section>

  <!-- INSTAGRAM SLIDER -->
  <section style="margin-top:24px">
    <h3 class="section-title" data-en="Instagram" data-ar="انستغرام">Instagram</h3>
    <div style="display:flex;gap:12px;overflow:auto;padding:12px 0" id="instaSlider"></div>
    <div style="text-align:center;margin-top:8px"><a id="instaPage" target="_blank" href="https://instagram.com/ryaanjewellers007">@ryaanjewellers007</a></div>
  </section>

  <!-- ENQUIRY & 360 VIEW -->
  <section style="margin-top:26px">
    <h3 class="section-title" data-en="Enquiry / Custom Orders" data-ar="الاستعلام / الطلبات المخصصة">Enquiry / Custom Orders</h3>
    <div class="enquiry">
      <input id="ename" placeholder="Full name" aria-label="Full name">
      <input id="ephone" placeholder="Phone (with country code)" aria-label="Phone">
      <input id="eproduct" placeholder="Product name (optional)" aria-label="Product">
      <textarea id="emessage" rows="4" placeholder="Message / requirements" aria-label="Message"></textarea>
      <div style="display:flex;gap:8px;margin-top:10px">
        <button class="btn" onclick="sendEnquiry()">Send via WhatsApp</button>
        <button class="smallbtn" onclick="openCart()">View Cart</button>
        <button class="smallbtn" onclick="open360Placeholder()">360° View</button>
      </div>
    </div>
  </section>

  <!-- VISION / MISSION / STORY -->
  <section style="margin-top:26px">
    <h3 class="section-title" data-en="Our Vision & Story" data-ar="رؤيتنا وقصتنا">Our Vision & Story</h3>
    <div style="background:var(--card);padding:14px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)">
      <h4 data-en="Vision" data-ar="الرؤية">Vision</h4>
      <p data-en="To craft exquisite 18k jewellery inspired by the world's finest maisons — accessible with impeccable finish." data-ar="صياغة مجوهرات 18 قيراط مستوحاة من أفضل دور الأزياء العالمية بلمسات نهائية فائقة الجودة.">To craft exquisite 18k jewellery inspired by the world's finest maisons — accessible with impeccable finish.</p>
      <h4 data-en="Mission" data-ar="المهمة">Mission</h4>
      <p data-en="Deliver luxury with integrity: premium materials, precise finishing, fast customer service." data_ar="تقديم الفخامة بنزاهة: مواد مميزة، تشطيب دقيق، خدمة عملاء سريعة.">Deliver luxury with integrity: premium materials, precise finishing, fast customer service.</p>
      <h4 data-en="Story" data-ar="القصة">Story</h4>
      <p data-en="Ryaan Jewellers started with a passion for refined detail — crafting pieces to be loved and worn forever." data-ar="بدأت Ryaan Jewellers بشغف للتفاصيل الدقيقة — نصنع قطعاً تُحب وتُرتدى إلى الأبد.">Ryaan Jewellers started with a passion for refined detail — crafting pieces to be loved and worn forever.</p>
    </div>
  </section>

  <!-- CONTACT -->
  <section id="contact" style="margin-top:26px;text-align:center">
    <h3 class="section-title" data-en="Contact" data-ar="اتصل">Contact</h3>
    <p class="muted">ryaanjewellers@gmail.com • +971543746476 • RyaanJewellers.com</p>
  </section>

</div> <!-- container -->

<!-- CART DRAWER -->
<div id="cartDrawer" aria-hidden="true">
  <h3 style="font-family:Cinzel,serif;color:var(--gold)">Your Cart</h3>
  <div id="cartItems"></div>
  <div style="margin-top:12px">
    <div style="display:flex;justify-content:space-between"><div class="muted">Total</div><div id="cartTotal" style="font-weight:800;color:var(--gold)">AED 0</div></div>
    <div style="display:flex;gap:8px;margin-top:10px">
      <button class="btn" onclick="checkoutStripe()">Pay Card</button>
      <button class="smallbtn" onclick="checkoutWhatsApp()">Pay WhatsApp</button>
    </div>
    <button class="smallbtn" style="margin-top:12px;width:100%" onclick="toggleCart()">Close</button>
  </div>
</div>

<!-- 360 modal -->
<div id="modal360" class="modal" role="dialog" aria-modal="true">
  <div class="modal-box">
    <h4 id="modal360title">360° View</h4>
    <div id="viewer360" style="height:420px;background:#000;border-radius:8px;display:flex;align-items:center;justify-content:center;color:var(--muted)">Upload images named &lt;id&gt;_360_1.jpg ... to use 360° viewer</div>
    <div style="text-align:right;margin-top:10px"><button class="smallbtn" onclick="closeModal360()">Close</button></div>
  </div>
</div>

<!-- FOOTER -->
<footer>
  <div class="container">
    <img id="footerLogo" alt="Ryaan logo" style="height:72px;margin-bottom:8px">
    <div class="muted">© 2025 Ryaan Jewellers — Gold & Diamonds - Crafted with Love & Precious</div>
    <div style="margin-top:8px" class="muted">18k Gold White Yellow Rose — Inspired versions: Messika, Van Cleef, Chopard, Cartier, Marli, Boucheron</div>
  </div>
</footer>

<!-- external libs -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
/* ========= CONFIG ========= */
const TRY_BASES = [
  "https://raw.githubusercontent.com/ryaanjewellers007/Ryaanjewellers/main/",
  "https://raw.githubusercontent.com/ryaanjewellers007/Ryaanjewellers007/main/",
  "https://raw.githubusercontent.com/ryaanjewellers007/ryaanjewellers007/main/"
];
// if you deploy serverless for gold and stripe, set it here:
window.VERCEL_API_BASE = window.VERCEL_API_BASE || ""; // e.g. "https://your-vercel.vercel.app"
window.STRIPE_PUBLISHABLE_KEY = window.STRIPE_PUBLISHABLE_KEY || ""; // set when you have it

// assets you use (logo + hero + product S_1..S_13)
const ASSETS = {
  logo: "Logo new ryaan.png",
  hero: "S_1.jpg",
  products: ["Screenshot_20251129_014621_Chrome.jpg","Screenshot_20251129_014443_Chrome.jpg","Screenshot_20251129_014656_Chrome.jpg","Screenshot_20251129_014713_Chrome.jpg","S_5.jpg","S_6.jpg","S_7.jpg","S_8.jpg","S_9.jpg","S_10.jpg","S_11.jpg","S_12.jpg","S_13.jpg"]
};

/* ========= IMAGE LOADER HELPERS =========
   Tries multiple raw base URLs to avoid broken images when repo name differs */
function tryLoadImage(filename, imgEl){
  const bases = TRY_BASES.slice(0);
  function attempt(){
    if(bases.length===0){
      // final fallback: show alt text
      imgEl.onerror=null;
      imgEl.style.display='none';
      const p = document.createElement('div');
      p.style.color='var(--muted)';
      p.style.textAlign='center';
      p.style.fontSize='14px';
      p.innerText = filename;
      imgEl.parentNode && imgEl.parentNode.insertBefore(p,imgEl);
      console.warn("Image not found: ", filename);
      return;
    }
    const base = bases.shift();
    const url = base + encodeURIComponent(filename).replaceAll('%2F','/').replaceAll('%20','%20');
    imgEl.src = url;
    imgEl.onerror = attempt;
    imgEl.onload = ()=> { console.info("Loaded image", url); imgEl.onerror=null; };
    console.log("Trying image URL:", url);
  }
  attempt();
}

/* load header/footer/splash logos and hero */
document.addEventListener('DOMContentLoaded', ()=>{
  // header logo
  tryLoadImage(ASSETS.logo, document.getElementById('headerLogo'));
  tryLoadImage(ASSETS.logo, document.getElementById('splashLogo'));
  tryLoadImage(ASSETS.logo, document.getElementById('footerLogo'));

  // hero bg
  const hero = document.getElementById('heroSlide');
  // try set as first successful URL
  (async function setHero(){
    for(const base of TRY_BASES){
      try{
        const url = base + encodeURIComponent(ASSETS.hero).replaceAll('%2F','/').replaceAll('%20','%20');
        // quick HEAD request by creating image
        const img = new Image();
        img.src = url;
        await new Promise(r => { img.onload = r; img.onerror = r; });
        if(img.width>0){
          hero.style.backgroundImage = `url("${url}")`;
          break;
        }
      }catch(e){}
    }
  })();

  // load product slides and grid
  buildProducts();

  // build categories from products
  buildCategories();

  // build instagram slider (use product images as placeholder)
  buildInstagram();

  // splash sparkles
  buildSplash();

  // start gold fetch / fallback engine
  initGold();

  // language + theme apply
  applyLang(localStorage.getItem('ry_lang') || 'en');
  applyTheme(localStorage.getItem('ry_theme') || 'dark');
});

/* ========= SPLASH ========= */
function buildSplash(){
  const wrap = document.getElementById('splashSpark');
  if(!wrap) return;
  const spots = [
    {left:'10%',top:'18%',d:0},{left:'72%',top:'24%',d:0.4},{left:'40%',top:'72%',d:0.9},{left:'82%',top:'70%',d:1.4},{left:'22%',top:'60%',d:1.8},{left:'56%',top:'42%',d:0.6}
  ];
  spots.forEach((s,i)=>{
    const sp = document.createElement('span');
    sp.style.left = s.left; sp.style.top = s.top; sp.style.position = 'absolute';
    sp.style.width = (6 + Math.round(Math.random()*6)) + 'px';
    sp.style.height = sp.style.width;
    sp.style.animationDelay = (s.d + (i*0.12)) + 's';
    wrap.appendChild(sp);
  });

  // hide splash after load or after 5s
  window.addEventListener('load', hideSplash);
  setTimeout(hideSplash, 5500);

  function hideSplash(){
    const s = document.getElementById('splash');
    if(!s) return;
    s.classList.add('hide-splash');
    setTimeout(()=>{ s.style.display='none'; }, 1000);
  }
}

/* ========= PRODUCTS UI ========= */
const PRODUCTS = ASSETS.products.map((fn,i)=>({
  id: 'P' + (100 + i),
  title: (["Chic Lattice","Maison Classic","Éclat","Royal Motif","Petite Étoile","Aurora Braid","Celeste Drop","Opal Curve","Luna Band","Velvet Hoop","Regal Chain","Solitaire Muse","Marli Twist"][i] || 'Item') + ' - 18K',
  img: fn,
  purity: 18,
  weight: Math.round(5 + Math.random()*10),
  cat: ['rings','necklaces','bracelets','earrings','rings','necklaces','bracelets','earrings','rings','necklaces','bracelets','earrings','necklaces'][i] || 'rings'
}));

function buildProducts(){
  const slider = document.getElementById('productSlider');
  slider.innerHTML = '';
  PRODUCTS.forEach(p=>{
    const d = document.createElement('div');
    d.className = 'product';
    // image element with loader
    const img = document.createElement('img');
    tryLoadImage(p.img, img);
    d.appendChild(img);
    const title = document.createElement('div'); title.style.marginTop='8px'; title.style.fontWeight='700'; title.style.color='var(--gold)'; title.innerText = p.title;
    d.appendChild(title);
    const meta = document.createElement('div'); meta.className='muted'; meta.style.marginTop='6px'; meta.innerText = `${p.purity}K • ${p.weight}g`;
    d.appendChild(meta);
    const actions = document.createElement('div'); actions.style.marginTop='8px';
    actions.innerHTML = `<div style="display:flex;gap:8px"><button class="btn" style="flex:1" onclick="addToCart('${p.id}')">Add</button><button class="smallbtn" style="flex:1" onclick="viewProduct('${p.id}')">View</button></div>`;
    d.appendChild(actions);
    slider.appendChild(d);
  });

  // grid
  buildGrid();
}

function buildGrid(list){
  const grid = document.getElementById('productGrid');
  grid.innerHTML = '';
  (list || PRODUCTS).forEach(p=>{
    const box = document.createElement('div'); box.className='product';
    const wrapper = document.createElement('div'); wrapper.style.background='linear-gradient(180deg,#0c0c0c,#0f0f0f)'; wrapper.style.padding='10px'; wrapper.style.borderRadius='8px';
    const img = document.createElement('img'); img.style.height='160px'; img.style.objectFit='cover'; img.style.borderRadius='8px';
    tryLoadImage(p.img, img);
    wrapper.appendChild(img);
    box.appendChild(wrapper);
    const title = document.createElement('div'); title.style.marginTop='8px'; title.style.fontWeight='700'; title.style.color='var(--gold)'; title.innerText = p.title;
    box.appendChild(title);
    const meta = document.createElement('div'); meta.className='muted'; meta.innerText = `${p.purity}K • ${p.weight}g`;
    box.appendChild(meta);
    const actions = document.createElement('div'); actions.style.marginTop='8px'; actions.style.display='flex'; actions.style.gap='8px';
    const add = document.createElement('button'); add.className='btn'; add.style.flex='1'; add.innerText='Add'; add.onclick = ()=>addToCart(p.id);
    const view = document.createElement('button'); view.className='smallbtn'; view.style.flex='1'; view.innerText='View'; view.onclick = ()=>viewProduct(p.id);
    actions.appendChild(add); actions.appendChild(view);
    box.appendChild(actions);
    grid.appendChild(box);
  });
}

function buildCategories(){
  const row = document.getElementById('categoryRow');
  const cats = [...new Set(PRODUCTS.map(p=>p.cat))];
  row.innerHTML = '';
  cats.forEach(c=>{
    const el = document.createElement('div'); el.className='cat'; el.onclick = ()=>{ const filtered = PRODUCTS.filter(p=>p.cat===c); buildGrid(filtered); };
    const img = document.createElement('img'); tryLoadImage(PRODUCTS.find(p=>p.cat===c).img, img);
    el.appendChild(img);
    const label = document.createElement('div'); label.style.marginTop='8px'; label.style.fontWeight='700'; label.style.color='var(--gold)'; label.innerText = c.charAt(0).toUpperCase() + c.slice(1);
    el.appendChild(label);
    row.appendChild(el);
  });
}

/* ========= INSTAGRAM (placeholder using product images) ========= */
function buildInstagram(){
  const slider = document.getElementById('instaSlider');
  slider.innerHTML = '';
  PRODUCTS.slice(0,8).forEach(p=>{
    const img = document.createElement('img'); img.style.width='220px'; img.style.height='220px'; img.style.objectFit='cover'; img.style.borderRadius='8px';
    tryLoadImage(p.img, img);
    img.onclick = ()=> window.open('https://instagram.com/ryaanjewellers007','_blank');
    slider.appendChild(img);
  });
}

/* ========= CART ========= */
function getCart(){ return JSON.parse(localStorage.getItem('ry_cart')||'[]'); }
function saveCart(c){ localStorage.setItem('ry_cart', JSON.stringify(c)); renderCart(); }
function addToCart(pid){
  const item = PRODUCTS.find(p=>p.id===pid);
  if(!item) return alert('Product not found');
  const cart = getCart();
  const found = cart.find(i=>i.id===pid);
  if(found) found.qty++;
  else cart.push({id:pid,qty:1});
  saveCart(cart);
  alert('Added: ' + item.title);
}
function renderCart(){
  const root = document.getElementById('cartItems');
  if(!root) return;
  const cart = getCart();
  root.innerHTML = '';
  if(cart.length===0){ root.innerHTML = '<div class="muted">Cart empty</div>'; document.getElementById('cartTotal').innerText='AED 0'; return; }
  let total = 0;
  cart.forEach(ci=>{
    const p = PRODUCTS.find(x=>x.id===ci.id);
    const price = computePrice(p);
    total += price * ci.qty;
    const el = document.createElement('div'); el.className='cart-item';
    const img = document.createElement('img'); img.style.width='60px'; img.style.height='60px'; img.style.objectFit='cover'; tryLoadImage(p.img, img);
    const info = document.createElement('div'); info.style.flex='1';
    info.innerHTML = `<div style="font-weight:700">${p.title}</div><div class="muted">${ci.qty} x AED ${price.toFixed(2)}</div>`;
    const actions = document.createElement('div'); actions.innerHTML = `<div style="display:flex;flex-direction:column;gap:6px"><button class="smallbtn" onclick="changeQty('${p.id}',1)">+</button><button class="smallbtn" onclick="changeQty('${p.id}',-1)">-</button></div>`;
    el.appendChild(img); el.appendChild(info); el.appendChild(actions);
    root.appendChild(el);
  });
  document.getElementById('cartTotal').innerText = 'AED ' + total.toFixed(2);
}
function changeQty(id, delta){
  const cart = getCart();
  const it = cart.find(i=>i.id===id);
  if(!it) return;
  it.qty += delta;
  if(it.qty<=0) cart.splice(cart.indexOf(it),1);
  saveCart(cart);
}
function toggleCart(){ const d=document.getElementById('cartDrawer'); if(!d) return; d.classList.toggle('open'); d.setAttribute('aria-hidden', d.classList.contains('open')? 'false' : 'true'); renderCart(); }
function openCart(){ const d=document.getElementById('cartDrawer'); d.classList.add('open'); d.setAttribute('aria-hidden','false'); renderCart(); }

/* compute price by weight and purity with markup */
function computePrice(p){
  const perGram = window.latest24 || 500;
  const base = perGram * (p.purity/24) * p.weight;
  return base * 1.15; // 15% markup
}

/* ========= CHECKOUT ========= */
function checkoutWhatsApp(){
  const cart = getCart(); if(cart.length===0) return alert('Cart empty');
  let message = 'Order from Ryaan Jewellers%0A%0A';
  let total=0;
  cart.forEach(ci=>{
    const p = PRODUCTS.find(x=>x.id===ci.id);
    const price = computePrice(p);
    message += `${p.title} x ${ci.qty} - AED ${ (price*ci.qty).toFixed(2) }%0A`;
    total += price*ci.qty;
  });
  message += `%0ATotal: AED ${total.toFixed(2)}%0A%0APlease confirm availability.`;
  window.open('https://wa.me/971543746476?text=' + encodeURIComponent(message), '_blank');
}

async function checkoutStripe(){
  // if you deploy /api/create-checkout-session on Vercel, set VERCEL_API_BASE to its domain so this will work
  if(!window.VERCEL_API_BASE) return alert('Stripe checkout not configured. I can generate serverless code for you.');
  const cart = getCart();
  if(cart.length===0) return alert('Cart empty');
  const items = cart.map(ci=>{
    const p = PRODUCTS.find(x=>x.id===ci.id);
    return {name:p.title,quantity:ci.qty,unit_amount_aed: Math.round(computePrice(p)*100)};
  });
  try{
    const res = await fetch(window.VERCEL_API_BASE + '/api/create-checkout-session', {
      method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({items})
    });
    const data = await res.json();
    if(data.sessionId){
      if(!window.STRIPE_PUBLISHABLE_KEY) return alert('Stripe publishable key not set on page.');
      const stripe = Stripe(window.STRIPE_PUBLISHABLE_KEY);
      const result = await stripe.redirectToCheckout({sessionId: data.sessionId});
      if(result.error) alert(result.error.message);
    } else {
      alert('Checkout error: ' + (data.error || 'unknown'));
    }
  }catch(e){ console.error(e); alert('Checkout failed'); }
}

/* ========= 360 VIEW placeholder ========= */
function open360Placeholder(){
  const modal = document.getElementById('modal360');
  modal.classList.add('open');
  document.getElementById('modal360title').innerText = '360° viewer';
}
function closeModal360(){ document.getElementById('modal360').classList.remove('open'); }

/* ========= GOLD PRICE ENGINE =========
   - will try Vercel /api/gold if configured; else uses public fallback + exchangerate.host
   - stores latest24 in window.latest24
*/
async function fetchGoldFromVercel(){
  if(!window.VERCEL_API_BASE) return false;
  try{
    const r = await fetch(window.VERCEL_API_BASE + '/api/gold');
    if(!r.ok) return false;
    const j = await r.json();
    if(j.price_per_gram){ window.latest24 = Number(j.price_per_gram); return true; }
    if(j.price){ window.latest24 = Number(j.price); return true; }
    return false;
  }catch(e){ return false; }
}

async function fetchGoldPublic(){
  try{
    // try goldprice.org
    let ounceUSD = null;
    try{
      const res = await fetch('https://data-asg.goldprice.org/dbXRates/USD', {cache:'no-store'});
      if(res.ok){ const j=await res.json(); ounceUSD = Number(j.items?.[0]?.xauPrice || j.items?.[0]?.price); }
    }catch(e){}
    if(!ounceUSD){
      // fallback metals.live
      try{
        const res2 = await fetch('https://api.metals.live/v1/spot/gold', {cache:'no-store'});
        if(res2.ok){ const j2 = await res2.json(); ounceUSD = Number(j2?.[0]?.price || j2?.[0]); }
      }catch(e){}
    }
    if(!ounceUSD) return false;
    // convert USD -> AED
    const fx = await fetch('https://api.exchangerate.host/convert?from=USD&to=AED', {cache:'no-store'});
    if(!fx.ok) return false;
    const jfx = await fx.json();
    const rate = Number(jfx.result || jfx.info?.rate || jfx.rates?.AED);
    const ounceAED = ounceUSD * rate;
    const perGram = ounceAED / 31.1034768;
    window.latest24 = perGram;
    return true;
  }catch(e){ console.warn(e); return false; }
}

let goldChart;
async function initGold(){
  // try vercel first
  let ok = await fetchGoldFromVercel();
  if(!ok) ok = await fetchGoldPublic();
  if(!ok) window.latest24 = 500;
  updateGoldUI();
  // setup chart
  const ctx = document.getElementById('goldChart').getContext('2d');
  goldChart = new Chart(ctx, {type:'line',data:{labels:[],datasets:[{label:'24K AED/g',data:[],borderColor:window.getComputedStyle(document.documentElement).getPropertyValue('--gold')||'#D4AF37',backgroundColor:'rgba(212,175,55,0.08)',tension:0.3}]},options:{responsive:true,plugins:{legend:{display:false}}}});
  pushGoldPoint(window.latest24 || 500);

  // refresh every 30s
  setInterval(async ()=>{ const ok = await fetchGoldFromVercel() || await fetchGoldPublic(); if(!ok) window.latest24 = window.latest24 || 500; updateGoldUI(); pushGoldPoint(window.latest24); }, 30000);
}

function updateGoldUI(){
  const p24 = window.latest24 || 500;
  document.getElementById('g24').innerText = Number(p24).toFixed(2);
  document.getElementById('g22').innerText = Number(p24*(22/24)).toFixed(2);
  document.getElementById('g18').innerText = Number(p24*(18/24)).toFixed(2);
  document.getElementById('goldUpdated').innerText = new Date().toLocaleTimeString();
}

function pushGoldPoint(v){
  if(!goldChart) return;
  const label = new Date().toLocaleTimeString();
  goldChart.data.labels.push(label);
  goldChart.data.datasets[0].data.push(Number((v||500).toFixed(2)));
  if(goldChart.data.labels.length>24){ goldChart.data.labels.shift(); goldChart.data.datasets[0].data.shift(); }
  goldChart.update();
}

/* ========= LANGUAGE & THEME ========= */
function applyLang(lang){
  localStorage.setItem('ry_lang', lang);
  document.querySelectorAll('[data-en]').forEach(el=>{
    const en = el.getAttribute('data-en') || '';
    const ar = el.getAttribute('data-ar') || en;
    el.innerText = (lang==='ar') ? ar : en;
  });
  // arrows, dir
  document.documentElement.dir = (lang==='ar') ? 'rtl' : 'ltr';
  document.getElementById('langToggle').innerText = (lang==='ar') ? 'EN' : 'AR';
}
document.getElementById('langToggle').addEventListener('click', ()=>{
  const next = (localStorage.getItem('ry_lang')==='ar') ? 'en' : 'ar';
  applyLang(next);
});

function applyTheme(theme){
  localStorage.setItem('ry_theme', theme);
  if(theme === 'light') document.documentElement.setAttribute('data-theme','light');
  else document.documentElement.removeAttribute('data-theme');
  document.getElementById('themeToggle').innerText = (theme==='light') ? '☼' : '☾';
}
document.getElementById('themeToggle').addEventListener('click', ()=>{
  const next = (localStorage.getItem('ry_theme') === 'light') ? 'dark' : 'light';
  applyTheme(next);
});

/* ========= ENQUIRY WHATSAPP ========= */
function sendEnquiry(){
  const name = document.getElementById('ename').value || '';
  const phone = document.getElementById('ephone').value || '';
  const product = document.getElementById('eproduct').value || '';
  const msg = document.getElementById('emessage').value || '';
  const body = `Name: ${name}%0APhone: ${phone}%0AProduct: ${product}%0AMessage: ${msg}`;
  window.open('https://wa.me/971543746476?text=' + encodeURIComponent(body), '_blank');
}

/* ========= small utilities ========= */
function viewProduct(id){ const p = PRODUCTS.find(x=>x.id===id); if(!p) return; alert(p.title + "\\n" + p.purity + "K • " + p.weight + "g"); }

/* expose some globals for quick debug in browser console */
window.tryLoadImage = tryLoadImage;
window.PRODUCTS = PRODUCTS;
window.addToCart = addToCart;
window.toggleCart = toggleCart;
window.checkoutWhatsApp = checkoutWhatsApp;
window.checkoutStripe = checkoutStripe;
window.open360Placeholder = open360Placeholder;

// initial render (load from DOMContent)
document.addEventListener('DOMContentLoaded', ()=>{ buildProducts(); buildCategories(); buildInstagram(); renderCart(); applyLang(localStorage.getItem('ry_lang')||'en'); applyTheme(localStorage.getItem('ry_theme')||'dark'); });

</script>
</body>
</html>
